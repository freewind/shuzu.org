<html>
<head>
    <title>gradle-kotlin-js-bundler-plugin - 数组网</title>
    <link rel="stylesheet" href="../../css/site.css">
    <link rel="stylesheet" href="../../css/github-markdown-2.10.0.css">
    <script src="../../js/showdown-1.8.6.min.js"></script>
</head>
<body>

<div id="demo-header">
    <div class="site-slogan">gradle-kotlin-js-bundler-plugin</div>
</div>

<div id="readme" class="center-in-page">
    <div class="markdown markdown-body">
        Gradle Kotlin Js Bundler Plugin
===============================

A gradle plugin can extract required js files from dependent jars, and combine them with the js file generated by `compileKotlin2Js`, in correct order.

Please note that all the files generated by `compileKotlin2Js`(including dependencies) should use `plain` format type (which is default)

Publish
-------

Can only install to maven local for now:

```
./gradlew install
```

Use it
------

```
buildscript {
    repositories {
        mavenLocal()
    }
    dependencies {
        classpath &#39;freewind.github.com:gradle-kotlin-js-bundler-plugin:0.1.0&#39;
    }
}

apply plugin: &#39;kotlin-js-bundler&#39;

kotlinJsBundler {
    additionalJsFiles = []
    outputFile = &quot;$projectDir/bundle.js&quot;
}
```

Testing
-------

```
cd testing-project
./gradlew kotlinJsBundler
```

It will generate a `bundle.js` file when everything is working well, the file combined all required files like `kotlin.js`, so we can just include only one js file in `index.html`.

Then open `testing-project/index.html` and you will see

- an alert: `{&quot;name&quot;:&quot;Freewind&quot;}`
- console: `my hello`, from external `my.js`

which means everything is OK.

    </div>
</div>

<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/build.gradle" target="_blank" title="show github file">build.gradle</a>
        </div>
        <div class="path">testing-project/build.gradle</div>
    </div>
    <div class="body">
        <pre class="content"><code class="gradle">buildscript {
    ext.kotlin_version = &#39;1.2.51&#39;
    repositories {
        mavenLocal()
        maven { url &#39;http://maven.aliyun.com/nexus/content/groups/public/&#39; }
        maven { url &#39;http://maven.aliyun.com/nexus/content/repositories/jcenter&#39; }
        jcenter()
        maven { url(&quot;https://plugins.gradle.org/m2/&quot;) }
    }
    dependencies {
        classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot;
        classpath &#39;freewind.github.com:gradle-kotlin-js-bundler-plugin:0.1.0&#39;
    }
}

apply plugin: &#39;kotlin2js&#39;
apply plugin: &#39;kotlin-js-bundler&#39;

//compileKotlin2Js {
//    kotlinOptions.outputFile = &quot;${projectDir}/generated/hello.js&quot;
//}

kotlinJsBundler {
    additionalJsFiles = [&quot;data/my.js&quot;]
    outputFile = &quot;${projectDir}/bundle.js&quot;
}

repositories {
    mavenLocal()
    maven { url &#39;http://maven.aliyun.com/nexus/content/groups/public/&#39; }
    maven { url &#39;http://maven.aliyun.com/nexus/content/repositories/jcenter&#39; }
    jcenter()
    maven { url &#39;https://dl.bintray.com/freewind/maven/&#39; }
}

dependencies {
    compile &quot;org.jetbrains.kotlin:kotlin-stdlib-js:$kotlin_version&quot;
    compile &#39;freewind.github.com:kotlin-js-commons:0.6.0&#39;
    testCompile &quot;org.jetbrains.kotlin:kotlin-test-js:$kotlin_version&quot;
}

</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/data/my.js" target="_blank" title="show github file">my.js</a>
        </div>
        <div class="path">testing-project/data/my.js</div>
    </div>
    <div class="body">
        <pre class="content"><code class="js">function myHello() {
    console.log(&quot;my hello&quot;)
}</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/src/main/kotlin/example/Hello.kt" target="_blank" title="show github file">Hello.kt</a>
        </div>
        <div class="path">testing-project/src/main/kotlin/example/Hello.kt</div>
    </div>
    <div class="body">
        <pre class="content"><code class="kt">package example

import kotlinjs.common.jsonAs
import kotlin.browser.window

fun main(args: Array&lt;String&gt;) {
    val user = jsonAs&lt;User&gt;().apply {
        this.name = &quot;Freewind&quot;
    }
    window.alert(JSON.stringify(user))
    myHello()
}

interface User {
    var name: String
}

@JsName(&quot;myHello&quot;)
external fun myHello()</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/package.json" target="_blank" title="show github file">package.json</a>
        </div>
        <div class="path">testing-project/package.json</div>
    </div>
    <div class="body">
        <pre class="content"><code class="json">{
  &quot;name&quot;: &quot;kotlin-js-hello-world-demo&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;Kotlin JS Hello World Demo =======================&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;repository&quot;: {
    &quot;type&quot;: &quot;git&quot;,
    &quot;url&quot;: &quot;git+https://github.com/kotlin-demos/kotlin-js-hello-world-demo.git&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;bugs&quot;: {
    &quot;url&quot;: &quot;https://github.com/kotlin-demos/kotlin-js-hello-world-demo/issues&quot;
  },
  &quot;homepage&quot;: &quot;https://github.com/kotlin-demos/kotlin-js-hello-world-demo#readme&quot;,
  &quot;dependencies&quot;: {
    &quot;kotlin&quot;: &quot;^1.2.51&quot;
  }
}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/index.html" target="_blank" title="show github file">index.html</a>
        </div>
        <div class="path">testing-project/index.html</div>
    </div>
    <div class="body">
        <pre class="content"><code class="html">&lt;html&gt;
&lt;script src=&quot;./bundle.js&quot;&gt;&lt;/script&gt;
&lt;/html&gt;</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/build.gradle" target="_blank" title="show github file">build.gradle</a>
        </div>
        <div class="path">build.gradle</div>
    </div>
    <div class="body">
        <pre class="content"><code class="gradle">apply plugin: &#39;groovy&#39;
apply plugin: &#39;maven&#39;

repositories {
    mavenLocal()
    jcenter()
}

group &#39;freewind.github.com&#39;
version &#39;0.1.0&#39;

dependencies {
    compile gradleApi()
    compile localGroovy()
    testCompile &#39;junit:junit:4.11&#39;
    testCompile &#39;org.easytesting:fest-assert-core:2.0M10&#39;
}

</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/my-module1.js" target="_blank" title="show github file">my-module1.js</a>
        </div>
        <div class="path">src/test/resources/my-module1.js</div>
    </div>
    <div class="body">
        <pre class="content"><code class="js">if (typeof kotlin === &#39;undefined&#39;) {
  throw new Error(&quot;Error loading module &#39;my-module1&#39;. Its dependency &#39;kotlin&#39; was not found. Please, check whether &#39;kotlin&#39; is loaded prior to &#39;my-module1&#39;.&quot;);
}
this[&#39;my-module1&#39;] = function (_, Kotlin) {
  &#39;use strict&#39;;
  function main(args) {
    console.log(&#39;Hello, plain_demo&#39;);
  }
  var package$plain_demo = _.plain_demo || (_.plain_demo = {});
  package$plain_demo.main_kand9s$ = main;
  main([]);
  Kotlin.defineModule(&#39;my-module1&#39;, _);
  return _;
}(typeof this[&#39;my-module1&#39;] === &#39;undefined&#39; ? {} : this[&#39;my-module1&#39;], kotlin);
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/kotlin.js" target="_blank" title="show github file">kotlin.js</a>
        </div>
        <div class="path">src/test/resources/kotlin.js</div>
    </div>
    <div class="body">
        <pre class="content"><code class="js">this[&#39;kotlin&#39;] = function (_, Kotlin) {
  &#39;use strict&#39;;
  function main(args) {
    console.log(&#39;Hello, plain_demo&#39;);
  }
  var package$plain_demo = _.plain_demo || (_.plain_demo = {});
  package$plain_demo.main_kand9s$ = main;
  main([]);
  Kotlin.defineModule(&#39;kotlin&#39;, _);
  return _;
}(typeof this[&#39;kotlin&#39;] === &#39;undefined&#39; ? {} : this[&#39;kotlin&#39;], kotlin);
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/non-kotlin-module.js" target="_blank" title="show github file">non-kotlin-module.js</a>
        </div>
        <div class="path">src/test/resources/non-kotlin-module.js</div>
    </div>
    <div class="body">
        <pre class="content"><code class="js">console.log(&quot;I&#39;m not kotlin js module&quot;);</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/my-module2.js" target="_blank" title="show github file">my-module2.js</a>
        </div>
        <div class="path">src/test/resources/my-module2.js</div>
    </div>
    <div class="body">
        <pre class="content"><code class="js">if (typeof kotlin === &#39;undefined&#39;) {
  throw new Error(&quot;Error loading module &#39;my-module2&#39;. Its dependency &#39;kotlin&#39; was not found. Please, check whether &#39;kotlin&#39; is loaded prior to &#39;my-module2&#39;.&quot;);
}
if (typeof this[&#39;my-module1&#39;] === &#39;undefined&#39;) {
  throw new Error(&quot;Error loading module &#39;my-module2&#39;. Its dependency &#39;my-module1&#39; was not found. Please, check whether &#39;my-module1&#39; is loaded prior to &#39;my-module2&#39;.&quot;);
}
this[&#39;my-module2&#39;] = function (_, Kotlin, $module$my_lib1) {
  &#39;use strict&#39;;
  function main(args) {
    console.log(&#39;Hello, plain_demo&#39;);
  }
  var package$plain_demo = _.plain_demo || (_.plain_demo = {});
  package$plain_demo.main_kand9s$ = main;
  main([]);
  Kotlin.defineModule(&#39;my-module2&#39;, _);
  return _;
}(typeof this[&#39;my-module2&#39;] === &#39;undefined&#39; ? {} : this[&#39;my-module2&#39;], kotlin, this[&#39;my-module1&#39;]);
</code></pre>
    </div>
</div>

<div class="github center-in-page markdown-body">
    <span class="github-icon"><img src="../../images/github.jpg"></span>
    <span class="repo-url">
        <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin">打开Github项目地址</a>
    </span>
    <span class="repo-issues">
        <a href="https://github.com/freewind-demos/gradle-kotlin-js-bundler-plugin/issues?q=">有疑问上Github Issues上讨论</a>
    </span>
</div>

<script src="../../js/site.js"></script>
<script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274292847'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1274292847' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>