<html>
<head>
    <title>sonar-java-custom-rules-template - 数组网</title>
    <link rel="stylesheet" href="../../css/site.css">
    <link rel="stylesheet" href="../../css/github-markdown-2.10.0.css">
    <script src="../../js/showdown-1.8.6.min.js"></script>
</head>
<body>

<div id="demo-header">
    <div class="site-slogan">sonar-java-custom-rules-template</div>
</div>


<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/pom.xml" target="_blank">pom.xml</a>
        </div>
        <div class="path">pom.xml</div>
    </div>
    <div class="body">
        <pre class="content"><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;org.sonar.samples&lt;/groupId&gt;
  &lt;artifactId&gt;java-custom-rules-template&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;sonar-plugin&lt;/packaging&gt;

  &lt;properties&gt;
    &lt;sonar.plugin.api.version&gt;4.5.7&lt;/sonar.plugin.api.version&gt;
    &lt;java.plugin.version&gt;3.13.1&lt;/java.plugin.version&gt;
  &lt;/properties&gt;

  &lt;name&gt;Java Custom Rules - Template&lt;/name&gt;
  &lt;description&gt;Empty template for custom rules&lt;/description&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.codehaus.sonar&lt;/groupId&gt;
      &lt;artifactId&gt;sonar-plugin-api&lt;/artifactId&gt;
      &lt;version&gt;${sonar.plugin.api.version}&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;
      &lt;artifactId&gt;sonar-java-plugin&lt;/artifactId&gt;
      &lt;type&gt;sonar-plugin&lt;/type&gt;
      &lt;version&gt;${java.plugin.version}&lt;/version&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;
      &lt;artifactId&gt;java-frontend&lt;/artifactId&gt;
      &lt;version&gt;${java.plugin.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.sonarsource.sslr-squid-bridge&lt;/groupId&gt;
      &lt;artifactId&gt;sslr-squid-bridge&lt;/artifactId&gt;
      &lt;version&gt;2.6.1&lt;/version&gt;
      &lt;exclusions&gt;
        &lt;exclusion&gt;
          &lt;groupId&gt;org.codehaus.sonar.sslr&lt;/groupId&gt;
          &lt;artifactId&gt;sslr-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
      &lt;/exclusions&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.sonarsource.java&lt;/groupId&gt;
      &lt;artifactId&gt;java-checks-testkit&lt;/artifactId&gt;
      &lt;version&gt;${java.plugin.version}&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
      &lt;groupId&gt;org.codehaus.sonar.sslr&lt;/groupId&gt;
      &lt;artifactId&gt;sslr-testing-harness&lt;/artifactId&gt;
      &lt;version&gt;1.19.2&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;4.11&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.easytesting&lt;/groupId&gt;
      &lt;artifactId&gt;fest-assert&lt;/artifactId&gt;
      &lt;version&gt;1.4&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;version&gt;0.9.30&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.sonarsource.sonar-packaging-maven-plugin&lt;/groupId&gt;
        &lt;artifactId&gt;sonar-packaging-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.15&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;pluginClass&gt;org.sonar.template.java.JavaCustomRulesPlugin&lt;/pluginClass&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;

      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.7&lt;/source&gt;
          &lt;target&gt;1.7&lt;/target&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;

&lt;!--       &lt;plugin&gt; --&gt;
&lt;!--         &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; --&gt;
&lt;!--         &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt; --&gt;
&lt;!--         &lt;version&gt;2.10&lt;/version&gt; --&gt;
&lt;!--         &lt;executions&gt; --&gt;
&lt;!--           &lt;execution&gt; --&gt;
&lt;!--             &lt;id&gt;copy&lt;/id&gt; --&gt;
&lt;!--             &lt;phase&gt;test-compile&lt;/phase&gt; --&gt;
&lt;!--             &lt;goals&gt; --&gt;
&lt;!--               &lt;goal&gt;copy&lt;/goal&gt; --&gt;
&lt;!--             &lt;/goals&gt; --&gt;
&lt;!--             &lt;configuration&gt; --&gt;
&lt;!--               &lt;artifactItems&gt; --&gt;
&lt;!--                 &lt;artifactItem&gt; --&gt;
&lt;!--                   &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; --&gt;
&lt;!--                   &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt; --&gt;
&lt;!--                   &lt;version&gt;4.0&lt;/version&gt; --&gt;
&lt;!--                   &lt;type&gt;jar&lt;/type&gt; --&gt;
&lt;!--                 &lt;/artifactItem&gt; --&gt;
&lt;!--               &lt;/artifactItems&gt; --&gt;
&lt;!--               &lt;outputDirectory&gt;${project.build.directory}/test-jars&lt;/outputDirectory&gt; --&gt;
&lt;!--             &lt;/configuration&gt; --&gt;
&lt;!--           &lt;/execution&gt; --&gt;
&lt;!--         &lt;/executions&gt; --&gt;
&lt;!--       &lt;/plugin&gt; --&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

&lt;/project&gt;
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/main/java/org/sonar/template/java/checks/package-info.java" target="_blank">package-info.java</a>
        </div>
        <div class="path">src/main/java/org/sonar/template/java/checks/package-info.java</div>
    </div>
    <div class="body">
        <pre class="content"><code class="java">@ParametersAreNonnullByDefault
package org.sonar.template.java.checks;

/**
 * This package contains the custom rules
 */
import javax.annotation.ParametersAreNonnullByDefault;
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/main/java/org/sonar/template/java/JavaCustomRulesCheckRegistrar.java" target="_blank">JavaCustomRulesCheckRegistrar.java</a>
        </div>
        <div class="path">src/main/java/org/sonar/template/java/JavaCustomRulesCheckRegistrar.java</div>
    </div>
    <div class="body">
        <pre class="content"><code class="java">package org.sonar.template.java;

import org.sonar.plugins.java.api.CheckRegistrar;

/**
 * Provide the &quot;checks&quot; (implementations of rules) classes that are going to be executed during
 * source code analysis.
 *
 * This class is a batch extension by implementing the {@link org.sonar.plugins.java.api.CheckRegistrar} interface.
 */
public class JavaCustomRulesCheckRegistrar implements CheckRegistrar {

  /**
   * Register the classes that will be used to instantiate checks during analysis.
   */
  @Override
  public void register(RegistrarContext registrarContext) {
    // Call to registerClassesForRepository to associate the classes with the correct repository key
    registrarContext.registerClassesForRepository(JavaCustomRulesDefinition.REPOSITORY_KEY, JavaCustomRulesList.getJavaChecks(), JavaCustomRulesList.getJavaTestChecks());
  }
}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/main/java/org/sonar/template/java/JavaCustomRulesDefinition.java" target="_blank">JavaCustomRulesDefinition.java</a>
        </div>
        <div class="path">src/main/java/org/sonar/template/java/JavaCustomRulesDefinition.java</div>
    </div>
    <div class="body">
        <pre class="content"><code class="java">package org.sonar.template.java;

import com.google.common.collect.Iterables;

import org.sonar.api.server.rule.RulesDefinition;
import org.sonar.api.server.rule.RulesDefinitionAnnotationLoader;
import org.sonar.plugins.java.Java;

import java.util.List;

/**
 * Declare rule metadata in server repository of rules. 
 * That allows to list the rules in the page &quot;Rules&quot;.
 */
public class JavaCustomRulesDefinition implements RulesDefinition {

  public static final String REPOSITORY_KEY = &quot;java-custom-rules-template&quot;;

  @Override
  public void define(Context context) {
    NewRepository repository = context.createRepository(REPOSITORY_KEY, Java.KEY);
    repository.setName(&quot;Java Custom Rules - Template&quot;);

    List&lt;Class&gt; checks = JavaCustomRulesList.getChecks();
    new RulesDefinitionAnnotationLoader().load(repository, Iterables.toArray(checks, Class.class));
    repository.done();
  }

}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/main/java/org/sonar/template/java/JavaCustomRulesList.java" target="_blank">JavaCustomRulesList.java</a>
        </div>
        <div class="path">src/main/java/org/sonar/template/java/JavaCustomRulesList.java</div>
    </div>
    <div class="body">
        <pre class="content"><code class="java">package org.sonar.template.java;

import com.google.common.collect.ImmutableList;

import org.sonar.plugins.java.api.JavaCheck;

import java.util.List;

public final class JavaCustomRulesList {

  private JavaCustomRulesList() {
  }

  public static List&lt;Class&gt; getChecks() {
    return ImmutableList.&lt;Class&gt;builder().addAll(getJavaChecks()).addAll(getJavaTestChecks()).build();
  }

  public static List&lt;Class&lt;? extends JavaCheck&gt;&gt; getJavaChecks() {
    return ImmutableList.&lt;Class&lt;? extends JavaCheck&gt;&gt;builder()
      // add HERE rules targeting source files
      .build();
  }

  public static List&lt;Class&lt;? extends JavaCheck&gt;&gt; getJavaTestChecks() {
    return ImmutableList.&lt;Class&lt;? extends JavaCheck&gt;&gt;builder()
      // add HERE rules targeting test files
      .build();
  }
}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/main/java/org/sonar/template/java/JavaCustomRulesPlugin.java" target="_blank">JavaCustomRulesPlugin.java</a>
        </div>
        <div class="path">src/main/java/org/sonar/template/java/JavaCustomRulesPlugin.java</div>
    </div>
    <div class="body">
        <pre class="content"><code class="java">package org.sonar.template.java;

import org.sonar.api.SonarPlugin;

import java.util.Arrays;
import java.util.List;

/**
 * Entry point of plugin
 */
public class JavaCustomRulesPlugin extends SonarPlugin {

  @Override
  public List getExtensions() {
    return Arrays.asList(
      // server extensions -&gt; objects are instantiated during server startup
      JavaCustomRulesDefinition.class,

      // batch extensions -&gt; objects are instantiated during code analysis
      JavaCustomRulesCheckRegistrar.class);
  }
}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/test/files/testFiles.txt" target="_blank">testFiles.txt</a>
        </div>
        <div class="path">src/test/files/testFiles.txt</div>
    </div>
    <div class="body">
        <pre class="content"><code class="txt">Place your test files in this folder</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/blob/master/src/test/java/org/sonar/template/java/JavaCustomRulesDefinitionTest.java" target="_blank">JavaCustomRulesDefinitionTest.java</a>
        </div>
        <div class="path">src/test/java/org/sonar/template/java/JavaCustomRulesDefinitionTest.java</div>
    </div>
    <div class="body">
        <pre class="content"><code class="java">package org.sonar.template.java;

import org.junit.Test;
import org.sonar.api.server.rule.RulesDefinition;

import static org.fest.assertions.Assertions.assertThat;

public class JavaCustomRulesDefinitionTest {

  @Test
  public void registration_test() {
    JavaCustomRulesDefinition definition = new JavaCustomRulesDefinition();
    RulesDefinition.Context context = new RulesDefinition.Context();
    definition.define(context);
    RulesDefinition.Repository repository = context.repository(&quot;java-custom-rules-template&quot;);

    assertThat(repository.key()).isEqualTo(&quot;java-custom-rules-template&quot;);
    assertThat(repository.name()).isEqualTo(&quot;Java Custom Rules - Template&quot;);
    assertThat(repository.language()).isEqualTo(&quot;java&quot;);
    assertThat(repository.rules()).hasSize(JavaCustomRulesList.getChecks().size());
  }
}
</code></pre>
    </div>
</div>

<div class="github center-in-page markdown-body">
    <span class="github-icon"><img src="../../images/github.jpg"></span>
    <span class="repo-url">
        <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template">打开Github项目地址</a>
    </span>
    <span class="repo-issues">
        <a href="https://github.com/freewind-demos/sonar-java-custom-rules-template/issues?q=">有问题上Github Issues上讨论</a>
    </span>
</div>

<script src="../../js/site.js"></script>
<script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274292847'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1274292847' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>