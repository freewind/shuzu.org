<html>
<head>
    <title>go-secret-connection-demo - 数组网</title>
    <link rel="stylesheet" href="../../css/site.css">
    <link rel="stylesheet" href="../../css/github-markdown-2.10.0.css">
    <script src="../../js/showdown-1.8.6.min.js"></script>
</head>
<body>

<div id="demo-header">
    <div class="site-slogan">go-secret-connection-demo</div>
</div>

<div id="readme" class="center-in-page">
    <div class="markdown markdown-body">
        Go Secret Connection Demo
=========================

Make public keys transfer in secret between peers.

```
brew install go
go get
go run server.go
go run client.go
```

Server sample log
-----------------

```
privateKey: len(69) A3 28 89 12 40 91 47 FF E3 6D 39 D9 FE 5D 6C 9C 71 FE 03 A9 2C E6 1A B3 E6 90 CC EC A8 32 C6 BE C8 D2 56 64 D8 99 02 9C C1 D9 FF 48 89 5D A0 6E EE 09 96 AE 39 48 B0 78 F6 76 92 F7 D6 61 A2 81 2B BB 32 57 0C
publicKey: len(37) 16 24 DE 62 20 99 02 9C C1 D9 FF 48 89 5D A0 6E EE 09 96 AE 39 48 B0 78 F6 76 92 F7 D6 61 A2 81 2B BB 32 57 0C
Send my ephPublicKey to peer: len(32) CE 15 7A 8E 2B C9 E7 29 2C 46 86 33 C9 24 0B A6 61 62 A8 2B 6A 9F DD A1 C9 2F 77 44 89 C1 E4 63
Received remote ephPublicKey from peer: len(32) E2 14 4D CE 3A 50 37 00 9B 15 85 1A 28 AD C3 E4 11 E0 46 7E 6B 69 06 A3 EF C6 42 6D 80 87 08 51
shared secret(should be the same to peer&#39;s): len(32) 76 55 FC D3 B5 FB 2E 77 D2 E4 CC B5 CB 39 F5 26 A7 67 57 71 7F A1 CE 45 CB 63 42 87 CF F3 4E 3E
lowEphPubKey : len(32) CE 15 7A 8E 2B C9 E7 29 2C 46 86 33 C9 24 0B A6 61 62 A8 2B 6A 9F DD A1 C9 2F 77 44 89 C1 E4 63
highEphPubKey: len(32) E2 14 4D CE 3A 50 37 00 9B 15 85 1A 28 AD C3 E4 11 E0 46 7E 6B 69 06 A3 EF C6 42 6D 80 87 08 51
receiveNonce: len(24) B6 D8 99 33 23 23 FD C0 9B E0 F0 33 EB A6 DA 10 21 3E 9A 1E 00 00 00 00
sendNonce   : len(24) B6 D8 99 33 23 23 FD C0 9B E0 F0 33 EB A6 DA 10 21 3E 9A 1E 00 00 00 01
challenge: len(32) 0E B3 2E CF DF CD 3A D3 EA CB 95 9F 70 74 14 58 DF 09 B3 7A F2 B8 1D 9C 0B 0A 60 ED 2A 27 34 3B
signature: len(69) 3D A1 DB 2A 40 27 75 C6 E7 A0 01 48 20 9D 22 FE 13 B7 62 85 B7 84 9B 03 8F A3 92 D9 4D 8F A4 5A E2 86 27 68 6A 23 48 DC E0 EA C0 14 6A F5 4A 81 CC BE 46 24 50 FB DA 40 1E E1 B8 6A 61 1C 90 F6 A7 D6 5A CA 08
authSignature: len(106) 16 24 DE 62 20 99 02 9C C1 D9 FF 48 89 5D A0 6E EE 09 96 AE 39 48 B0 78 F6 76 92 F7 D6 61 A2 81 2B BB 32 57 0C 3D A1 DB 2A 40 27 75 C6 E7 A0 01 48 20 9D 22 FE 13 B7 62 85 B7 84 9B 03 8F A3 92 D9 4D 8F A4 5A E2 86 27 68 6A 23 48 DC E0 EA C0 14 6A F5 4A 81 CC BE 46 24 50 FB DA 40 1E E1 B8 6A 61 1C 90 F6 A7 D6 5A CA 08
sealed message to send: len(122) 58 E3 DD EB FC 0D 09 EE 07 CA AA F8 4E 41 B6 71 B5 46 BC F7 4D 28 09 69 D8 FC 9C F8 4C BE 15 38 62 4E B9 29 E3 50 21 00 D4 E3 C5 8C 48 98 18 1C BC F1 72 A6 76 67 57 FD C6 DE 33 31 FC 5A E8 A2 99 C8 79 2B 2D 06 ED 82 AA E4 C3 75 2D CB 6F 5A EA 61 60 93 C4 04 94 79 E5 F2 41 F8 B4 98 BA 50 D9 ED 96 0D C5 23 D2 A8 26 E4 5F 2E AB 6D 0D 51 16 7A 00 47 FB 4C 42 80 98 E0
sendNonce now is: len(24) B6 D8 99 33 23 23 FD C0 9B E0 F0 33 EB A6 DA 10 21 3E 9A 1E 00 00 00 03
read length of message:  122
read sealed message: len(122) CC 9F 75 8D E1 48 DB 5C A6 C3 83 C6 0C DE 48 74 7E 70 64 5C 7B 77 59 FE A0 52 93 E1 7B 31 A4 D0 99 13 C2 B6 CE 9F 2E 1F FD A3 81 32 6C 94 44 A3 2D 44 CA BE D1 0D E7 39 A0 FD A2 DE BF CB FE 48 40 4E 60 7E 96 40 2A 54 7B 10 3A 49 FE DA 02 BE F4 AA 39 53 FB 31 9B 80 DC B2 F4 72 35 00 60 20 DC 04 99 05 F9 89 AF 84 53 E3 08 E4 35 55 15 F5 F2 7B 3E EE BC 2A CF EF 9A 08
message opened: len(106) 16 24 DE 62 20 B9 36 44 29 53 B9 64 4A 32 C4 B6 67 72 A1 5E 34 2A 1D F0 F3 9C 0B 07 F8 16 9C 86 E1 EB 3F 15 FC 3D A1 DB 2A 40 0E F0 DA F3 15 F1 6F 6D CF D7 EF D9 C7 58 D8 B2 EB 89 6B 51 FF 43 CB 6B 50 82 D5 1B 56 6E C9 4E 42 AC 87 68 97 F6 DE A7 35 64 1D 6E B2 3C 6B 31 95 38 B3 A6 76 1A B0 AD 35 A9 C9 6C 2C AB 96 05
remotePublicKeyBytes: len(37) 16 24 DE 62 20 B9 36 44 29 53 B9 64 4A 32 C4 B6 67 72 A1 5E 34 2A 1D F0 F3 9C 0B 07 F8 16 9C 86 E1 EB 3F 15 FC
remoteSignatureBytes: len(69) 3D A1 DB 2A 40 0E F0 DA F3 15 F1 6F 6D CF D7 EF D9 C7 58 D8 B2 EB 89 6B 51 FF 43 CB 6B 50 82 D5 1B 56 6E C9 4E 42 AC 87 68 97 F6 DE A7 35 64 1D 6E B2 3C 6B 31 95 38 B3 A6 76 1A B0 AD 35 A9 C9 6C 2C AB 96 05
remotePublicKey: len(37) 16 24 DE 62 20 B9 36 44 29 53 B9 64 4A 32 C4 B6 67 72 A1 5E 34 2A 1D F0 F3 9C 0B 07 F8 16 9C 86 E1 EB 3F 15 FC
remoteSignature: len(69) 3D A1 DB 2A 40 0E F0 DA F3 15 F1 6F 6D CF D7 EF D9 C7 58 D8 B2 EB 89 6B 51 FF 43 CB 6B 50 82 D5 1B 56 6E C9 4E 42 AC 87 68 97 F6 DE A7 35 64 1D 6E B2 3C 6B 31 95 38 B3 A6 76 1A B0 AD 35 A9 C9 6C 2C AB 96 05
Verification is OK, we are in secret
```

Client sample log
-----------------

```
privateKey: len(69) A3 28 89 12 40 CD 3D 46 A1 23 E1 F3 54 6D 30 E9 15 EC A8 2C 55 4B C6 FE 50 BD 41 38 A0 B5 1C 34 37 70 65 15 85 B9 36 44 29 53 B9 64 4A 32 C4 B6 67 72 A1 5E 34 2A 1D F0 F3 9C 0B 07 F8 16 9C 86 E1 EB 3F 15 FC
publicKey: len(37) 16 24 DE 62 20 B9 36 44 29 53 B9 64 4A 32 C4 B6 67 72 A1 5E 34 2A 1D F0 F3 9C 0B 07 F8 16 9C 86 E1 EB 3F 15 FC
Send my ephPublicKey to peer: len(32) E2 14 4D CE 3A 50 37 00 9B 15 85 1A 28 AD C3 E4 11 E0 46 7E 6B 69 06 A3 EF C6 42 6D 80 87 08 51
Received remote ephPublicKey from peer: len(32) CE 15 7A 8E 2B C9 E7 29 2C 46 86 33 C9 24 0B A6 61 62 A8 2B 6A 9F DD A1 C9 2F 77 44 89 C1 E4 63
shared secret(should be the same to peer&#39;s): len(32) 76 55 FC D3 B5 FB 2E 77 D2 E4 CC B5 CB 39 F5 26 A7 67 57 71 7F A1 CE 45 CB 63 42 87 CF F3 4E 3E
lowEphPubKey : len(32) CE 15 7A 8E 2B C9 E7 29 2C 46 86 33 C9 24 0B A6 61 62 A8 2B 6A 9F DD A1 C9 2F 77 44 89 C1 E4 63
highEphPubKey: len(32) E2 14 4D CE 3A 50 37 00 9B 15 85 1A 28 AD C3 E4 11 E0 46 7E 6B 69 06 A3 EF C6 42 6D 80 87 08 51
receiveNonce: len(24) B6 D8 99 33 23 23 FD C0 9B E0 F0 33 EB A6 DA 10 21 3E 9A 1E 00 00 00 01
sendNonce   : len(24) B6 D8 99 33 23 23 FD C0 9B E0 F0 33 EB A6 DA 10 21 3E 9A 1E 00 00 00 00
challenge: len(32) 0E B3 2E CF DF CD 3A D3 EA CB 95 9F 70 74 14 58 DF 09 B3 7A F2 B8 1D 9C 0B 0A 60 ED 2A 27 34 3B
signature: len(69) 3D A1 DB 2A 40 0E F0 DA F3 15 F1 6F 6D CF D7 EF D9 C7 58 D8 B2 EB 89 6B 51 FF 43 CB 6B 50 82 D5 1B 56 6E C9 4E 42 AC 87 68 97 F6 DE A7 35 64 1D 6E B2 3C 6B 31 95 38 B3 A6 76 1A B0 AD 35 A9 C9 6C 2C AB 96 05
authSignature: len(106) 16 24 DE 62 20 B9 36 44 29 53 B9 64 4A 32 C4 B6 67 72 A1 5E 34 2A 1D F0 F3 9C 0B 07 F8 16 9C 86 E1 EB 3F 15 FC 3D A1 DB 2A 40 0E F0 DA F3 15 F1 6F 6D CF D7 EF D9 C7 58 D8 B2 EB 89 6B 51 FF 43 CB 6B 50 82 D5 1B 56 6E C9 4E 42 AC 87 68 97 F6 DE A7 35 64 1D 6E B2 3C 6B 31 95 38 B3 A6 76 1A B0 AD 35 A9 C9 6C 2C AB 96 05
sealed message to send: len(122) CC 9F 75 8D E1 48 DB 5C A6 C3 83 C6 0C DE 48 74 7E 70 64 5C 7B 77 59 FE A0 52 93 E1 7B 31 A4 D0 99 13 C2 B6 CE 9F 2E 1F FD A3 81 32 6C 94 44 A3 2D 44 CA BE D1 0D E7 39 A0 FD A2 DE BF CB FE 48 40 4E 60 7E 96 40 2A 54 7B 10 3A 49 FE DA 02 BE F4 AA 39 53 FB 31 9B 80 DC B2 F4 72 35 00 60 20 DC 04 99 05 F9 89 AF 84 53 E3 08 E4 35 55 15 F5 F2 7B 3E EE BC 2A CF EF 9A 08
sendNonce now is: len(24) B6 D8 99 33 23 23 FD C0 9B E0 F0 33 EB A6 DA 10 21 3E 9A 1E 00 00 00 02
read length of message:  122
read sealed message: len(122) 58 E3 DD EB FC 0D 09 EE 07 CA AA F8 4E 41 B6 71 B5 46 BC F7 4D 28 09 69 D8 FC 9C F8 4C BE 15 38 62 4E B9 29 E3 50 21 00 D4 E3 C5 8C 48 98 18 1C BC F1 72 A6 76 67 57 FD C6 DE 33 31 FC 5A E8 A2 99 C8 79 2B 2D 06 ED 82 AA E4 C3 75 2D CB 6F 5A EA 61 60 93 C4 04 94 79 E5 F2 41 F8 B4 98 BA 50 D9 ED 96 0D C5 23 D2 A8 26 E4 5F 2E AB 6D 0D 51 16 7A 00 47 FB 4C 42 80 98 E0
message opened: len(106) 16 24 DE 62 20 99 02 9C C1 D9 FF 48 89 5D A0 6E EE 09 96 AE 39 48 B0 78 F6 76 92 F7 D6 61 A2 81 2B BB 32 57 0C 3D A1 DB 2A 40 27 75 C6 E7 A0 01 48 20 9D 22 FE 13 B7 62 85 B7 84 9B 03 8F A3 92 D9 4D 8F A4 5A E2 86 27 68 6A 23 48 DC E0 EA C0 14 6A F5 4A 81 CC BE 46 24 50 FB DA 40 1E E1 B8 6A 61 1C 90 F6 A7 D6 5A CA 08
remotePublicKeyBytes: len(37) 16 24 DE 62 20 99 02 9C C1 D9 FF 48 89 5D A0 6E EE 09 96 AE 39 48 B0 78 F6 76 92 F7 D6 61 A2 81 2B BB 32 57 0C
remoteSignatureBytes: len(69) 3D A1 DB 2A 40 27 75 C6 E7 A0 01 48 20 9D 22 FE 13 B7 62 85 B7 84 9B 03 8F A3 92 D9 4D 8F A4 5A E2 86 27 68 6A 23 48 DC E0 EA C0 14 6A F5 4A 81 CC BE 46 24 50 FB DA 40 1E E1 B8 6A 61 1C 90 F6 A7 D6 5A CA 08
remotePublicKey: len(37) 16 24 DE 62 20 99 02 9C C1 D9 FF 48 89 5D A0 6E EE 09 96 AE 39 48 B0 78 F6 76 92 F7 D6 61 A2 81 2B BB 32 57 0C
remoteSignature: len(69) 3D A1 DB 2A 40 27 75 C6 E7 A0 01 48 20 9D 22 FE 13 B7 62 85 B7 84 9B 03 8F A3 92 D9 4D 8F A4 5A E2 86 27 68 6A 23 48 DC E0 EA C0 14 6A F5 4A 81 CC BE 46 24 50 FB DA 40 1E E1 B8 6A 61 1C 90 F6 A7 D6 5A CA 08
Verification is OK, we are in secret
```    </div>
</div>

<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/go-secret-connection-demo/blob/master/client.go" target="_blank">client.go</a>
        </div>
        <div class="path">client.go</div>
    </div>
    <div class="body">
        <pre class="content"><code class="go">package main

import (
	&quot;net&quot;
	&quot;github.com/golang-demos/go-secret-connection-demo/secret&quot;
)

func main() {
	privateKey, publicKey := secret.GenerateMyKeys()
	conn, _ := net.Dial(&quot;tcp&quot;, &quot;localhost:9999&quot;)
	secret.SecretTransfer(conn, privateKey, publicKey)
}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/go-secret-connection-demo/blob/master/secret/secret.go" target="_blank">secret.go</a>
        </div>
        <div class="path">secret/secret.go</div>
    </div>
    <div class="body">
        <pre class="content"><code class="go">package secret

import (
	&quot;golang.org/x/crypto/nacl/box&quot;
	&quot;crypto/rand&quot;
	&quot;github.com/golang-demos/go-utils-demo/goutils&quot;
	&quot;io&quot;
	&quot;net&quot;
	&quot;github.com/tendermint/go-crypto&quot;
	&quot;bytes&quot;
	&quot;golang.org/x/crypto/ripemd160&quot;
	&quot;crypto/sha256&quot;
	&quot;golang.org/x/crypto/nacl/secretbox&quot;
	&quot;encoding/binary&quot;
	&quot;fmt&quot;
)

func GenerateMyKeys() (privateKey crypto.PrivKeyEd25519, publicKey crypto.PubKey) {
	privateKey = crypto.GenPrivKeyEd25519()
	publicKey = privateKey.PubKey()
	return
}

func SecretTransfer(conn net.Conn, privateKey crypto.PrivKeyEd25519, publicKey crypto.PubKey) {
	goutils.PrintlnByteArray(&quot;privateKey&quot;, privateKey.Bytes())
	goutils.PrintlnByteArray(&quot;publicKey&quot;, publicKey.Bytes())

	ephPublicKey, ephPrivateKey, _ := box.GenerateKey(rand.Reader)

	conn.Write(ephPublicKey[:])
	goutils.PrintlnByteArray(&quot;Send my ephPublicKey to peer&quot;, ephPublicKey[:])

	var remoteEphPubKey [32]byte
	io.ReadFull(conn, remoteEphPubKey[:])
	goutils.PrintlnByteArray(&quot;Received remote ephPublicKey from peer&quot;, remoteEphPubKey[:])

	var sharedSecret [32]byte
	computeSharedSecret(&amp;sharedSecret, &amp;remoteEphPubKey, ephPrivateKey)
	goutils.PrintlnByteArray(&quot;shared secret(should be the same to peer&#39;s)&quot;, sharedSecret[:])

	lowEphPubKey, highEphPubKey := sortKeys(ephPublicKey, &amp;remoteEphPubKey)
	goutils.PrintlnByteArray(&quot;lowEphPubKey &quot;, lowEphPubKey[:])
	goutils.PrintlnByteArray(&quot;highEphPubKey&quot;, highEphPubKey[:])

	receiveNonce, sendNonce := genNonces(lowEphPubKey, highEphPubKey, ephPublicKey == lowEphPubKey)
	goutils.PrintlnByteArray(&quot;receiveNonce&quot;, receiveNonce[:])
	goutils.PrintlnByteArray(&quot;sendNonce   &quot;, sendNonce[:])

	challenge := genChallenge(lowEphPubKey, highEphPubKey)
	goutils.PrintlnByteArray(&quot;challenge&quot;, challenge[:])

	signature := signChallenge(challenge, privateKey)
	goutils.PrintlnByteArray(&quot;signature&quot;, signature.Bytes())

	authSignature := buildAuthSignature(publicKey, signature)
	goutils.PrintlnByteArray(&quot;authSignature&quot;, authSignature)

	sendAuthSignature(conn, authSignature, &amp;sharedSecret, sendNonce)

	remotePublicKey, remoteSignature := readRemoteAuthSignature(conn, &amp;sharedSecret, receiveNonce)
	goutils.PrintlnByteArray(&quot;remotePublicKey&quot;, remotePublicKey.Bytes())
	goutils.PrintlnByteArray(&quot;remoteSignature&quot;, remoteSignature.Bytes())

	ok := remotePublicKey.VerifyBytes(challenge[:], remoteSignature)
	if ok {
		fmt.Println(&quot;Verification is OK, we are in secret&quot;)
	} else {
		fmt.Println(&quot;Verification failed&quot;)
	}
}

func readRemoteAuthSignature(conn net.Conn, sharedSecret *[32]byte, receiveNonce *[24]byte) (remotePublicKey crypto.PubKey, remoteSignature crypto.Signature) {
	messageLength := readLength(conn)
	fmt.Println(&quot;read length of message: &quot;, messageLength)

	authMessage := make([]byte, messageLength)
	io.ReadFull(conn, authMessage)
	goutils.PrintlnByteArray(&quot;read sealed message&quot;, authMessage)

	var out []byte
	out, _ = secretbox.Open(out[:], authMessage, receiveNonce, sharedSecret)
	goutils.PrintlnByteArray(&quot;message opened&quot;, out)

	remotePublicKeyBytes := out[:37]
	remoteSignatureBytes := out[37:]

	goutils.PrintlnByteArray(&quot;remotePublicKeyBytes&quot;, remotePublicKeyBytes)
	goutils.PrintlnByteArray(&quot;remoteSignatureBytes&quot;, remoteSignatureBytes)

	remotePublicKey, _ = crypto.PubKeyFromBytes(remotePublicKeyBytes)
	remoteSignature, _ = crypto.SignatureFromBytes(remoteSignatureBytes)

	increase2(receiveNonce)

	return
}

func readLength(conn net.Conn) int {
	length := [2]byte{}
	io.ReadFull(conn, length[:])
	return int(binary.BigEndian.Uint16(length[:]))
}

func sendAuthSignature(conn net.Conn, message []byte, sharedKey *[32]byte, nonce *[24]byte) {
	var out []byte
	out = secretbox.Seal(out[:], message, nonce, sharedKey)
	goutils.PrintlnByteArray(&quot;sealed message to send&quot;, out)

	sendLength(conn, len(out))
	conn.Write(out)

	increase2(nonce)
	goutils.PrintlnByteArray(&quot;sendNonce now is&quot;, nonce[:])
}

func sendLength(conn net.Conn, length int) {
	conn.Write(int2bytes(uint16(length)))
}

func int2bytes(number uint16) []byte {
	bs := make([]byte, 2)
	binary.BigEndian.PutUint16(bs, number)
	return bs
}

func increase2(nonce *[24]byte) {
	increase1(nonce)
	increase1(nonce)
}

func increase1(nonce *[24]byte) {
	for i := 23; 0 &lt;= i; i-- {
		nonce[i] += 1
		if nonce[i] != 0 {
			return
		}
	}
}

func buildAuthSignature(publicKey crypto.PubKey, signature crypto.SignatureEd25519) (message []byte) {
	message = append(message, publicKey.Bytes()...)
	message = append(message, signature.Bytes()...)
	return
}

func signChallenge(challenge *[32]byte, localPrivateKey crypto.PrivKeyEd25519) (signature crypto.SignatureEd25519) {
	signature = localPrivateKey.Sign(challenge[:]).(crypto.SignatureEd25519)
	return
}

func genChallenge(lowEphPubKey *[32]byte, highEphPubKey *[32]byte) (challenge *[32]byte) {
	return hash32(append(lowEphPubKey[:], highEphPubKey[:]...))
}
func hash32(input []byte) (res *[32]byte) {
	hasher := sha256.New()
	hasher.Write(input)
	resSlice := hasher.Sum(nil)
	res = new([32]byte)
	copy(res[:], resSlice)
	return
}

func genNonces(lowKey *[32]byte, highKey *[32]byte, localIsLow bool) (receiveNonce, sendNonce *[24]byte) {
	nonce1 := hash24(append(lowKey[:], highKey[:]...))
	nonce2 := new([24]byte)
	copy(nonce2[:], nonce1[:])
	nonce2[len(nonce2)-1] ^= 0x01
	if localIsLow {
		receiveNonce = nonce1
		sendNonce = nonce2
	} else {
		receiveNonce = nonce2
		sendNonce = nonce1
	}
	return
}

func computeSharedSecret(sharedSecret, peerPublicKey, privateKey *[32]byte) {
	box.Precompute(sharedSecret, peerPublicKey, privateKey)
}

func sortKeys(key1, key2 *[32]byte) (low, high *[32]byte) {
	if bytes.Compare(key1[:], key2[:]) &lt; 0 {
		low = key1
		high = key2
	} else {
		low = key2
		high = key1
	}
	return
}

func hash24(input []byte) (res *[24]byte) {
	hasher := ripemd160.New()
	hasher.Write(input)
	resSlice := hasher.Sum(nil)
	res = new([24]byte)
	copy(res[:], resSlice)
	return
}
</code></pre>
    </div>
</div>
<div class="code-file center-in-page panel markdown-body">
    <div class="header">
        <div class="name">
            <a href="https://github.com/freewind-demos/go-secret-connection-demo/blob/master/server.go" target="_blank">server.go</a>
        </div>
        <div class="path">server.go</div>
    </div>
    <div class="body">
        <pre class="content"><code class="go">package main

import (
	&quot;net&quot;
	&quot;github.com/golang-demos/go-secret-connection-demo/secret&quot;
)

func main() {
	privateKey, publicKey := secret.GenerateMyKeys()

	listener, _ := net.Listen(&quot;tcp&quot;, &quot;localhost:9999&quot;)
	defer listener.Close()

	conn, _ := listener.Accept()

	secret.SecretTransfer(conn, privateKey, publicKey)
}
</code></pre>
    </div>
</div>

<div class="github center-in-page markdown-body">
    <span class="github-icon"><img src="../../images/github.jpg"></span>
    <span class="repo-url">
        <a href="https://github.com/freewind-demos/go-secret-connection-demo">打开Github项目地址</a>
    </span>
    <span class="repo-issues">
        <a href="https://github.com/freewind-demos/go-secret-connection-demo/issues?q=">有问题上Github Issues上讨论</a>
    </span>
</div>

<script src="../../js/site.js"></script>
<script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274292847'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1274292847' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>