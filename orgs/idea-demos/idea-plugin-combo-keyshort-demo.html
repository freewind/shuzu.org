<html>
  <head>
    <title>数组网 - 彪悍的Demo无需解释</title>
    <link href="/css/site.css" rel="stylesheet">
    <script src="/js/less-3.8.0.min.js"></script>
    <link href="/css/github-markdown-2.10.0.css" rel="stylesheet">
    <script src="/js/markdown-0.5.0.js"></script>
  </head>
  <body>
    <div id="header">
      <div class="site-slogan">彪悍的Demo无须解释</div>
      <div><span class="site-name"><a href="/">数组网</a></span><span class="site-url"><a href="shuzu.org">shuzu.org</a></span></div>
    </div>
    <div id="main">
      <div id="repo-main">
        <div class="navigation"><span><a href="/">数组网</a></span><span> &gt; </span><span class="org-link"><a href="/orgs/idea-demos/index.html">idea-demos</a></span><span> &gt; </span><span class="repo-name">idea-plugin-combo-keyshort-demo</span><span class="repo-description"></span></div>
        <div id="readme">
          <div class="markdown markdown-body">Idea Plugin Combo Keyshort Demo
===============================

You can press some keys at the same time, the matched words will be shown and put, which makes us coding fast.

The prototype is OK, but it has much of work to do to make it work perfectly.

Run plugin in IDEA
------------------

```
./gradlew runIde
```

Build the plugin to a zip
-------------------------

```
./gradlew buildPlugin
```

It will generate the plugin file in `./build/distributions`

Notice
-------

- Use `version 'IC-2018.1.5'` every time to reduce download. (about 500M)
- Don't forget to change `id` and `name` in `resources/META-INF/plugin.xml` to current project</div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/idea-demos/idea-plugin-combo-keyshort-demo/blob/master/build.gradle" target="_blank">build.gradle</a></div>
            <div class="path">build.gradle</div>
          </div>
          <div class="body">
            <pre class="content"><code class="gradle">buildscript {
    ext.kotlin_version = '1.2.50'
    repositories {
        jcenter()
    }
    dependencies {
        classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot;
    }
}

plugins {
    id &quot;org.jetbrains.intellij&quot; version &quot;0.3.4&quot;
}

apply plugin: 'kotlin'

intellij {
    version 'IC-2018.1.5'
    plugins = []
}

repositories {
    jcenter()
}

dependencies {
    compile &quot;org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version&quot;
    compile &quot;org.apache.commons:commons-lang3:3.7&quot;
    compile &quot;commons-io:commons-io:2.6&quot;
    testCompile &quot;junit:junit:4.11&quot;
    testCompile 'org.assertj:assertj-core:3.9.0'
    testCompile &quot;org.jetbrains.kotlin:kotlin-test-junit:$kotlin_version&quot;
}

task wrapper(type: Wrapper) {
    gradleVersion = &quot;4.6&quot;
}
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/idea-demos/idea-plugin-combo-keyshort-demo/blob/master/src/main/kotlin/actions/HelloAction.kt" target="_blank">HelloAction.kt</a></div>
            <div class="path">src/main/kotlin/actions/HelloAction.kt</div>
          </div>
          <div class="body">
            <pre class="content"><code class="kt">package actions

import com.intellij.openapi.actionSystem.AnAction
import com.intellij.openapi.actionSystem.AnActionEvent
import com.intellij.openapi.ui.Messages

class HelloAction : AnAction() {

    override fun actionPerformed(event: AnActionEvent) {
        println(&quot;event.inputEvent.isShiftDown: &quot; + event.inputEvent.isShiftDown)
        Messages.showInfoMessage(&quot;Hello from my plugin&quot;, &quot;Hello&quot;)
    }

}</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/idea-demos/idea-plugin-combo-keyshort-demo/blob/master/src/main/kotlin/example/HelloComponent.kt" target="_blank">HelloComponent.kt</a></div>
            <div class="path">src/main/kotlin/example/HelloComponent.kt</div>
          </div>
          <div class="body">
            <pre class="content"><code class="kt">package example

import com.intellij.openapi.components.ApplicationComponent
import org.apache.commons.lang.StringUtils
import java.awt.*
import java.awt.event.KeyEvent
import java.awt.event.KeyEvent.*
import kotlin.concurrent.thread

data class KeyTyped(val char: Char, val timestamp: Long)

class HelloComponent : ApplicationComponent {

    private val fakeSource = Canvas()

    private val keyTyped = mutableListOf&lt;KeyTyped&gt;()
    // FIXME non-thread-safe
    private val sending = mutableListOf&lt;KeyEvent&gt;()

    private val keywords = listOf(
            &quot;class&quot;,
            &quot;Hello&quot;,
            &quot;public&quot;,
            &quot;static&quot;,
            &quot;void&quot;,
            &quot;main&quot;,
            &quot;System&quot;,
            &quot;out&quot;,
            &quot;println&quot;,
            &quot;world&quot;,
            &quot;args&quot;,
            &quot;Array&quot;,
            &quot;String&quot;
    )

    override fun initComponent() {
        println(&quot;idea-plugin-hold-keys-and-send-together-demo:initComponent&quot;)
        Toolkit.getDefaultToolkit().addAWTEventListener({ event -&gt;
            when (event) {
                is KeyEvent -&gt; {
                    println(&quot;event.source: ${event.source.javaClass}&quot;)
                    val type = when (event.id) {
                        KEY_PRESSED -&gt; &quot;KEY_PRESSED&quot;
                        KEY_RELEASED -&gt; &quot;KEY_RELEASED&quot;
                        KEY_TYPED -&gt; &quot;KEY_TYPED&quot;
                        else -&gt; &quot;other&quot;
                    }
                    println(&quot;id: ${event.id}, type: $type&quot;)
                    when (event.source) {
                        is com.intellij.openapi.editor.impl.EditorComponentImpl -&gt; {
                            println(&quot;--------- ${event.keyChar} : ${event.hashCode()} ---------------&quot;)
                            println(&quot;keyEvents size: ${keyTyped.size}&quot;)
                            if (sending.contains(event)) {
                                sending.remove(event)
                            } else {
                                if (Character.isAlphabetic(event.keyChar.toInt())) {
                                    event.consume()
                                    if (event.id == KEY_RELEASED) {
                                        keyTyped.add(KeyTyped(event.keyChar, event.`when`))
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }, AWTEvent.KEY_EVENT_MASK)

        thread(isDaemon = true) {
            while (true) {
                keyTyped.lastOrNull()?.let { event -&gt;
                    val gap = System.currentTimeMillis() - event.timestamp
                    if (gap &gt;= 100) {
                        val todo = keyTyped.toList()
                        keyTyped.clear()

                        if (todo.size &gt;= 3) {
                            val matchedKeyword = keywords.find {
                                val chars = todo.map { it.char }.toSet()
                                it.containsAllCharsOf(chars)
                            }
                            println(&quot;matchedKeyword: $matchedKeyword&quot;)
                            if (matchedKeyword != null) {
                                matchedKeyword.forEach { c -&gt;
                                    createKeyEvent(KeyTyped(c, System.currentTimeMillis())).forEach { event -&gt;
                                        sending.add(event)
                                        Toolkit.getDefaultToolkit().systemEventQueue.postEvent(event)
                                    }

                                }
                            } else {
                                todo.forEach { charTyped -&gt;
                                    createKeyEvent(charTyped).forEach { event -&gt;
                                        sending.add(event)
                                        Toolkit.getDefaultToolkit().systemEventQueue.postEvent(event)
                                    }
                                }
                            }
                        } else {
                            todo.forEach { charTyped -&gt;
                                createKeyEvent(charTyped).forEach { event -&gt;
                                    sending.add(event)
                                    Toolkit.getDefaultToolkit().systemEventQueue.postEvent(event)
                                }
                            }
                        }
                    } else {
                        Thread.sleep(gap)
                    }
                } ?: Thread.sleep(50)
            }
        }
    }

    private fun createKeyEvent(keyTyped: KeyTyped): List&lt;KeyEvent&gt; {
        val key1 = KeyEvent(
                fakeSource,
                KEY_PRESSED,
                keyTyped.timestamp,
                0,
                KeyEvent.getExtendedKeyCodeForChar(keyTyped.char.toInt()),
                keyTyped.char
        )
        val key2 = KeyEvent(
                fakeSource,
                KEY_TYPED,
                keyTyped.timestamp,
                0,
                KeyEvent.getExtendedKeyCodeForChar(keyTyped.char.toInt()),
                keyTyped.char
        )
        val key3 = KeyEvent(
                fakeSource,
                KEY_RELEASED,
                keyTyped.timestamp,
                0,
                KeyEvent.getExtendedKeyCodeForChar(keyTyped.char.toInt()),
                keyTyped.char
        )
        return listOf(key1, key2, key3)
    }


//    private fun createKeyEvent(event: KeyEvent): KeyEvent {
//        return KeyEvent(
//                fakeSource,
//                event.id,
//                event.`when`,
//                event.modifiers,
//                event.keyCode,
//                event.keyChar,
//                event.keyLocation
//        )
//    }

}


private fun String.containsAllCharsOf(chars: Set&lt;Char&gt;): Boolean {
    return chars.all { this.toLowerCase().contains(it.toLowerCase()) }
}
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/idea-demos/idea-plugin-combo-keyshort-demo/blob/master/src/main/resources/META-INF/plugin.xml" target="_blank">plugin.xml</a></div>
            <div class="path">src/main/resources/META-INF/plugin.xml</div>
          </div>
          <div class="body">
            <pre class="content"><code class="xml">&lt;idea-plugin&gt;
    &lt;id&gt;idea-plugin-combo-keyshort-demo&lt;/id&gt;
    &lt;name&gt;idea-plugin-combo-keyshort-demo&lt;/name&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;vendor email=&quot;support@yourcompany.com&quot; url=&quot;http://www.yourcompany.com&quot;&gt;YourCompany&lt;/vendor&gt;

    &lt;description&gt;&lt;![CDATA[
      Enter short description for your plugin here.&lt;br&gt;
      &lt;em&gt;most HTML tags may be used&lt;/em&gt;
    ]]&gt;&lt;/description&gt;

    &lt;change-notes&gt;&lt;![CDATA[
      Add change notes here.&lt;br&gt;
      &lt;em&gt;most HTML tags may be used&lt;/em&gt;
    ]]&gt;
    &lt;/change-notes&gt;

    &lt;!-- please see http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/build_number_ranges.html for description --&gt;
    &lt;idea-version since-build=&quot;173.0&quot;/&gt;

    &lt;!-- please see http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/plugin_compatibility.html
         on how to target different products --&gt;
    &lt;!-- uncomment to enable plugin in all products
    &lt;depends&gt;com.intellij.modules.lang&lt;/depends&gt;
    --&gt;

    &lt;extensions defaultExtensionNs=&quot;com.intellij&quot;&gt;
        &lt;!-- Add your extensions here --&gt;
    &lt;/extensions&gt;

    &lt;application-components&gt;
        &lt;component&gt;
            &lt;implementation-class&gt;example.HelloComponent&lt;/implementation-class&gt;
        &lt;/component&gt;
    &lt;/application-components&gt;

    &lt;actions&gt;

        &lt;group id=&quot;idea-plugin-combo-keyshort-demo.MyPlugin.SampleMenu&quot; text=&quot;_Sample Menu&quot; description=&quot;Sample menu&quot;&gt;
            &lt;add-to-group group-id=&quot;MainMenu&quot; anchor=&quot;last&quot;/&gt;
            &lt;action id=&quot;idea-plugin-combo-keyshort-demo.action.popup&quot; class=&quot;actions.HelloAction&quot; text=&quot;_Popup&quot; description=&quot;Popup a message&quot;/&gt;
        &lt;/group&gt;

    &lt;/actions&gt;

&lt;/idea-plugin&gt;</code></pre>
          </div>
        </div>
        <div class="github markdown-body"><span class="github-icon"><img src="/images/github.jpg"></span><span class="repo-url"><a href="https://github.com/idea-demos/idea-plugin-combo-keyshort-demo">打开Github项目地址</a></span><span class="repo-issues"><a href="https://github.com/idea-demos/idea-plugin-combo-keyshort-demo/issues?q=">有问题上Github Issues上讨论</a></span></div>
      </div>
    </div>
    <script src="/js/site.js"></script>
  </body>
</html>
