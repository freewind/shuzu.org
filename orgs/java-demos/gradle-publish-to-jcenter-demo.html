<html>
  <head>
    <title>数组网 - 彪悍的Demo无需解释</title>
    <link href="/css/site.css" rel="stylesheet">
    <script src="/js/less-3.8.0.min.js"></script>
    <link href="/css/github-markdown-2.10.0.css" rel="stylesheet">
    <script src="/js/showdown-1.8.6.min.js"></script>
  </head>
  <body>
    <div id="header">
      <div class="site-slogan">彪悍的Demo无须解释</div>
      <div><span class="site-name"><a href="/">数组网</a></span><span class="site-url"><a href="shuzu.org">shuzu.org</a></span></div>
    </div>
    <div id="main">
      <div id="repo-main">
        <div class="navigation"><span><a href="/">数组网</a></span><span> &gt; </span><span class="org-link"><a href="/orgs/java-demos/index.html">java-demos</a></span><span> &gt; </span><span class="repo-name">gradle-publish-to-jcenter-demo</span><span class="repo-description"></span></div>
        <div id="readme">
          <div class="markdown markdown-body">Gradle Publish to Maven(JCenter) Demo
=====================================

There are two built-in repositories in gradle:

- `mavenCentral()`: &lt;http://maven.org/&gt;, and supported by sonatype.
- `jcenter()`: &lt;http://bintray.com&gt;

Since `jcenter` is much faster and developer friendly than `mavenCentral`, we can just publish our libs to jcenter by default.

Create a new Repository on bintray to hold such projects
--------------------------------------------------------

We can create many repositories on bintray. A repository is like a category to hold many projects(not the same as `repository` in github, but like `organization` in github).

If we have never created one, we can create it now:

1. view this page: &lt;https://bintray.com/freewind&gt;
2. click on &quot;Add New Repository&quot;
3. Choose a name, remember it's not just for this ONE project, so make it generic, like `maven`, or `demos`
4. Fill other information

Configure
---------

Update bintray information in `local.properties` of project root directory, and make sure this file is ignored by git.

You may want to create it if it's not present.

```
bintray.user=USERNAME
bintray.apikey=API_KEY
```

And change the values in `ext` of file `build.gradle` too.

Publish
-------

Publish to local:

```
./gradlew install
```

Publish to bintray:

```
./gradlew bintrayUpload
```

Request to sync to JCenter
--------------------------

The published files are not included i JCenter by default. We have to specify the url to get it:

```
repositories {
    maven {
        url 'https://dl.bintray.com/freewind/maven/'
    }
}
```

(Good enough for me though)

We need send a request if we want it to be included in jcenter:

- open the page: &lt;https://bintray.com/freewind/maven/gradle-publish-to-jcenter-demo&gt;
- Click on the `Add to JCenter` button
- Comments and send request

If the request is accepted, the future updated are synchronized to jcenter automatically.

I heard if there is no JavaDoc jars, the request may be rejected, this is maybe a bad news for kotlin project, since it can't generate JavaDoc easily. (need more investigating)

Testing the publishing
----------------------

Use a standard-alone project `testing-project` for testing:

```
cd testing-project
./gradlew compileJava
```

Notice we need to modify the `version` in `testing-project/build.gradle` if we published new version of the main project to bintray.

Resources
---------

- Example code: &lt;https://github.com/bintray/bintray-examples/blob/master/gradle-bintray-plugin-examples/configurations-example/build.gradle&gt;
- Short version (android project): &lt;https://medium.com/@yegor_zatsepin/simple-way-to-publish-your-android-library-to-jcenter-d1e145bacf13&gt;
- Long version: &lt;https://inthecheesefactory.com/blog/how-to-upload-library-to-jcenter-maven-central-as-dependency/en&gt;
</div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/blob/master/bintray.gradle" target="_blank">bintray.gradle</a></div>
            <div class="path">bintray.gradle</div>
          </div>
          <div class="body">
            <pre class="content"><code class="gradle">group = publishedGroupId
version = libraryVersion

install {
    repositories.mavenInstaller {
        pom.project {
            packaging 'aar'
            groupId publishedGroupId
            artifactId artifact

            name libraryName
            description libraryName
            url siteUrl

            licenses {
                license {
                    name licenseName
                    url licenseUrl
                }
            }
            developers {
                developer {
                    id developerId
                    name developerName
                    email developerEmail
                }
            }
            scm {
                connection gitUrl
                developerConnection gitUrl
                url siteUrl
            }
        }
    }
}

task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
}

artifacts {
    archives javadocJar
    archives sourcesJar
}

Properties properties = new Properties()
properties.load(project.rootProject.file('local.properties').newDataInputStream())

bintray {
    user = properties.getProperty(&quot;bintray.user&quot;)
    key = properties.getProperty(&quot;bintray.apikey&quot;)

    configurations = ['archives']
    pkg {
        repo = repoName
        name = artifact
        desc = libraryName
        websiteUrl = siteUrl
        vcsUrl = gitUrl
        licenses = allLicenses
        dryRun = false
        publish = true
        override = false
        publicDownloadNumbers = true
        version {
            desc = libraryName
        }
    }
}</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/blob/master/build.gradle" target="_blank">build.gradle</a></div>
            <div class="path">build.gradle</div>
          </div>
          <div class="body">
            <pre class="content"><code class="gradle">buildscript {
    repositories {
        mavenLocal()
        maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }
        maven { url 'http://maven.aliyun.com/nexus/content/repositories/jcenter' }
        jcenter()
    }
    dependencies {
        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.7.3'
    }
}

apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'com.jfrog.bintray'

repositories {
    mavenLocal()
    maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }
    maven { url 'http://maven.aliyun.com/nexus/content/repositories/jcenter' }
    jcenter()
}

dependencies {
    testCompile 'junit:junit:4.11'
    testCompile 'org.easytesting:fest-assert-core:2.0M10'
}

ext {
    // have to change
    publishedGroupId = 'freewind.demos'
    // `artifact` also use as and `bintray.pkg.name` for simplifying
    artifact = 'gradle-publish-to-jcenter-demo'
    libraryVersion = '0.3.0'
    // `libraryName` also uses as `bintray.pkg.libraryName` and `bintray.pkg.version.libraryName`
    libraryName = 'Gradle Publish To JCenter Demo'

    siteUrl = 'https://github.com/java-demos/gradle-publish-to-jcenter-demo'

    // normally no need to change
    repoName = 'maven'

    gitUrl = &quot;${siteUrl}.git&quot;

    developerId = 'freewind'
    developerName = 'Freewind'
    developerEmail = 'nowindlee@gmail.com'

    licenseName = 'The Apache Software License, Version 2.0'
    licenseUrl = 'http://www.apache.org/licenses/LICENSE-2.0.txt'
    allLicenses = [&quot;Apache-2.0&quot;]
}

apply from: 'bintray.gradle'
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/blob/master/src/main/java/gradle_publish_to_jcenter_demo/Hello.java" target="_blank">Hello.java</a></div>
            <div class="path">src/main/java/gradle_publish_to_jcenter_demo/Hello.java</div>
          </div>
          <div class="body">
            <pre class="content"><code class="java">package gradle_publish_to_jcenter_demo;

public class Hello {
    public String hello(String name) {
        return &quot;Hello, &quot; + name;
    }
}
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/blob/master/src/test/java/demos/gradle_publish_to_local_maven_demo/HelloSpec.java" target="_blank">HelloSpec.java</a></div>
            <div class="path">src/test/java/demos/gradle_publish_to_local_maven_demo/HelloSpec.java</div>
          </div>
          <div class="body">
            <pre class="content"><code class="java">package demos.gradle_publish_to_local_maven_demo;

import org.junit.Test;

import static org.fest.assertions.api.Assertions.assertThat;

public class HelloSpec {

    @Test
    public void shouldSayHello() throws Exception {
        String greeting = new Hello().hello(&quot;gradle&quot;);
        assertThat(greeting).isEqualTo(&quot;Hello, gradle&quot;);
    }

}
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/blob/master/testing-project/build.gradle" target="_blank">build.gradle</a></div>
            <div class="path">testing-project/build.gradle</div>
          </div>
          <div class="body">
            <pre class="content"><code class="gradle">apply plugin: 'java'

repositories {
    // this package is not requested to be included in jcenter, since it's just a dummy project
    // jcenter()
    // but I'm OK that we can use following url to get it
    maven {
        url 'https://dl.bintray.com/freewind/maven/'
    }
}

dependencies {
    compile &quot;freewind.demos:gradle-publish-to-jcenter-demo:0.3.0&quot;
}</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/blob/master/testing-project/src/main/java/testing/HelloTesting.java" target="_blank">HelloTesting.java</a></div>
            <div class="path">testing-project/src/main/java/testing/HelloTesting.java</div>
          </div>
          <div class="body">
            <pre class="content"><code class="java">package testing;

import gradle_publish_to_jcenter_demo.Hello;

public class HelloTesting {
    public static void main(String[] args) {
        System.out.println(new Hello().hello(&quot;JCenter&quot;));
    }
}
</code></pre>
          </div>
        </div>
        <div class="github markdown-body"><span class="github-icon"><img src="/images/github.jpg"></span><span class="repo-url"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo">打开Github项目地址</a></span><span class="repo-issues"><a href="https://github.com/java-demos/gradle-publish-to-jcenter-demo/issues?q=">有问题上Github Issues上讨论</a></span></div>
      </div>
    </div>
    <script src="/js/site.js"></script>
  </body>
</html>
