<html>
  <head>
    <title>数组网 - 彪悍的Demo无需解释</title>
    <link href="/css/site.css" rel="stylesheet">
    <script src="/js/less-3.8.0.min.js"></script>
    <link href="/css/github-markdown-2.10.0.css" rel="stylesheet">
    <script src="/js/markdown-0.5.0.js"></script>
  </head>
  <body>
    <div id="header">
      <div class="site-slogan">彪悍的Demo无须解释</div>
      <div><span class="site-name"><a href="/">数组网</a></span><span class="site-url"><a href="shuzu.org">shuzu.org</a></span></div>
    </div>
    <div id="main">
      <div id="repo-main">
        <div class="navigation"><span><a href="/">数组网</a></span><span> &gt; </span><span class="org-link"><a href="/orgs/groovy-demos/index.html">groovy-demos</a></span><span> &gt; </span><span class="repo-name">gradle-kotlin-js-bundler-plugin</span><span class="repo-description"></span></div>
        <div id="readme">
          <div class="markdown markdown-body">Gradle Kotlin Js Bundler Plugin
===============================

A gradle plugin can extract required js files from dependent jars, and combine them with the js file generated by `compileKotlin2Js`, in correct order.

Please note that all the files generated by `compileKotlin2Js`(including dependencies) should use `plain` format type (which is default)

Publish
-------

Can only install to maven local for now:

```
./gradlew install
```

Use it
------

```
buildscript {
    repositories {
        mavenLocal()
    }
    dependencies {
        classpath 'freewind.github.com:gradle-kotlin-js-bundler-plugin:0.1.0'
    }
}

apply plugin: 'kotlin-js-bundler'

kotlinJsBundler {
    additionalJsFiles = []
    outputFile = &quot;$projectDir/bundle.js&quot;
}
```

Testing
-------

```
cd testing-project
./gradlew kotlinJsBundler
```

It will generate a `bundle.js` file when everything is working well, the file combined all required files like `kotlin.js`, so we can just include only one js file in `index.html`.

Then open `testing-project/index.html` and you will see

- an alert: `{&quot;name&quot;:&quot;Freewind&quot;}`
- console: `my hello`, from external `my.js`

which means everything is OK.

</div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/build.gradle" target="_blank">build.gradle</a></div>
            <div class="path">build.gradle</div>
          </div>
          <div class="body">
            <pre class="content"><code class="gradle">apply plugin: 'groovy'
apply plugin: 'maven'

repositories {
    mavenLocal()
    jcenter()
}

group 'freewind.github.com'
version '0.1.0'

dependencies {
    compile gradleApi()
    compile localGroovy()
    testCompile 'junit:junit:4.11'
    testCompile 'org.easytesting:fest-assert-core:2.0M10'
}

</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/kotlin.js" target="_blank">kotlin.js</a></div>
            <div class="path">src/test/resources/kotlin.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">this['kotlin'] = function (_, Kotlin) {
  'use strict';
  function main(args) {
    console.log('Hello, plain_demo');
  }
  var package$plain_demo = _.plain_demo || (_.plain_demo = {});
  package$plain_demo.main_kand9s$ = main;
  main([]);
  Kotlin.defineModule('kotlin', _);
  return _;
}(typeof this['kotlin'] === 'undefined' ? {} : this['kotlin'], kotlin);
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/my-module1.js" target="_blank">my-module1.js</a></div>
            <div class="path">src/test/resources/my-module1.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">if (typeof kotlin === 'undefined') {
  throw new Error(&quot;Error loading module 'my-module1'. Its dependency 'kotlin' was not found. Please, check whether 'kotlin' is loaded prior to 'my-module1'.&quot;);
}
this['my-module1'] = function (_, Kotlin) {
  'use strict';
  function main(args) {
    console.log('Hello, plain_demo');
  }
  var package$plain_demo = _.plain_demo || (_.plain_demo = {});
  package$plain_demo.main_kand9s$ = main;
  main([]);
  Kotlin.defineModule('my-module1', _);
  return _;
}(typeof this['my-module1'] === 'undefined' ? {} : this['my-module1'], kotlin);
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/my-module2.js" target="_blank">my-module2.js</a></div>
            <div class="path">src/test/resources/my-module2.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">if (typeof kotlin === 'undefined') {
  throw new Error(&quot;Error loading module 'my-module2'. Its dependency 'kotlin' was not found. Please, check whether 'kotlin' is loaded prior to 'my-module2'.&quot;);
}
if (typeof this['my-module1'] === 'undefined') {
  throw new Error(&quot;Error loading module 'my-module2'. Its dependency 'my-module1' was not found. Please, check whether 'my-module1' is loaded prior to 'my-module2'.&quot;);
}
this['my-module2'] = function (_, Kotlin, $module$my_lib1) {
  'use strict';
  function main(args) {
    console.log('Hello, plain_demo');
  }
  var package$plain_demo = _.plain_demo || (_.plain_demo = {});
  package$plain_demo.main_kand9s$ = main;
  main([]);
  Kotlin.defineModule('my-module2', _);
  return _;
}(typeof this['my-module2'] === 'undefined' ? {} : this['my-module2'], kotlin, this['my-module1']);
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/src/test/resources/non-kotlin-module.js" target="_blank">non-kotlin-module.js</a></div>
            <div class="path">src/test/resources/non-kotlin-module.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">console.log(&quot;I'm not kotlin js module&quot;);</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/build.gradle" target="_blank">build.gradle</a></div>
            <div class="path">testing-project/build.gradle</div>
          </div>
          <div class="body">
            <pre class="content"><code class="gradle">buildscript {
    ext.kotlin_version = '1.2.51'
    repositories {
        mavenLocal()
        maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }
        maven { url 'http://maven.aliyun.com/nexus/content/repositories/jcenter' }
        jcenter()
        maven { url(&quot;https://plugins.gradle.org/m2/&quot;) }
    }
    dependencies {
        classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version&quot;
        classpath 'freewind.github.com:gradle-kotlin-js-bundler-plugin:0.1.0'
    }
}

apply plugin: 'kotlin2js'
apply plugin: 'kotlin-js-bundler'

//compileKotlin2Js {
//    kotlinOptions.outputFile = &quot;${projectDir}/generated/hello.js&quot;
//}

kotlinJsBundler {
    additionalJsFiles = [&quot;data/my.js&quot;]
    outputFile = &quot;${projectDir}/bundle.js&quot;
}

repositories {
    mavenLocal()
    maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }
    maven { url 'http://maven.aliyun.com/nexus/content/repositories/jcenter' }
    jcenter()
    maven { url 'https://dl.bintray.com/freewind/maven/' }
}

dependencies {
    compile &quot;org.jetbrains.kotlin:kotlin-stdlib-js:$kotlin_version&quot;
    compile 'freewind.github.com:kotlin-js-commons:0.6.0'
    testCompile &quot;org.jetbrains.kotlin:kotlin-test-js:$kotlin_version&quot;
}

</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/data/my.js" target="_blank">my.js</a></div>
            <div class="path">testing-project/data/my.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">function myHello() {
    console.log(&quot;my hello&quot;)
}</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/index.html" target="_blank">index.html</a></div>
            <div class="path">testing-project/index.html</div>
          </div>
          <div class="body">
            <pre class="content"><code class="html">&lt;html&gt;
&lt;script src=&quot;./bundle.js&quot;&gt;&lt;/script&gt;
&lt;/html&gt;</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/blob/master/testing-project/src/main/kotlin/example/Hello.kt" target="_blank">Hello.kt</a></div>
            <div class="path">testing-project/src/main/kotlin/example/Hello.kt</div>
          </div>
          <div class="body">
            <pre class="content"><code class="kt">package example

import kotlinjs.common.jsonAs
import kotlin.browser.window

fun main(args: Array&lt;String&gt;) {
    val user = jsonAs&lt;User&gt;().apply {
        this.name = &quot;Freewind&quot;
    }
    window.alert(JSON.stringify(user))
    myHello()
}

interface User {
    var name: String
}

@JsName(&quot;myHello&quot;)
external fun myHello()</code></pre>
          </div>
        </div>
        <div class="github markdown-body"><span class="github-icon"><img src="/images/github.jpg"></span><span class="repo-url"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin">打开Github项目地址</a></span><span class="repo-issues"><a href="https://github.com/groovy-demos/gradle-kotlin-js-bundler-plugin/issues?q=">有问题上Github Issues上讨论</a></span></div>
      </div>
    </div>
    <script src="/js/site.js"></script>
    <script type="javascript" src="https://s13.cnzz.com/z_stat.php?id=1274292847&amp;web_id=1274292847"></script>
  </body>
</html>
