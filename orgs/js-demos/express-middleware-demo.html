<html>
  <head>
    <title>数组网 - 彪悍的Demo无需解释</title>
    <link href="/css/site.css" rel="stylesheet">
    <script src="/js/less-3.8.0.min.js"></script>
    <link href="/css/github-markdown-2.10.0.css" rel="stylesheet">
    <script src="/js/markdown-0.5.0.js"></script>
  </head>
  <body>
    <div id="header">
      <div class="site-slogan">彪悍的Demo无须解释</div>
      <div><span class="site-name"><a href="/">数组网</a></span><span class="site-url"><a href="shuzu.org">shuzu.org</a></span></div>
    </div>
    <div id="main">
      <div id="repo-main">
        <div class="navigation"><span><a href="/">数组网</a></span><span> &gt; </span><span class="org-link"><a href="/orgs/js-demos/index.html">js-demos</a></span><span> &gt; </span><span class="repo-name">express-middleware-demo</span><span class="repo-description"></span></div>
        <div id="readme">
          <div class="markdown markdown-body">Express Middleware Demo
----------------------

```
npm install
node index.js
```

Will listen on `3000`.

Then visit:

```
curl http://localhost:3000/mike
curl http://localhost:3000/123
```

Application Level Middleware
----------------------------

```
node application-level-middleware.js
```

```
curl http://localhost:3000/
curl http://localhost:3000/next-route
```

Router Level Middleware
------------------------

```
node router-level-middleware.js
```

```
curl http://localhost:3000/sub
curl http://localhost:3000/sub/next-route
```

Error Level Middleware
-----------------------

```
node error-level-middleware.js
```

```
curl http://localhost:3000/
```

Built-in Level Middleware
-------------------------

```
node built-in-middleware.js
```

```
curl http://localhost:3000/index.html
```

3rd-party Middleware
--------------------

```
node application-level-middleware.js
```

```
curl --cookie &quot;USER_TOKEN=Yes&quot; http://localhost:3000/cookie
```

```
curl -X POST -d '{&quot;name&quot;:&quot;bbb&quot;,&quot;email&quot;:&quot;bbb.com&quot;}' -H &quot;Content-Type: application/json&quot; http://localhost:3000/json
```</div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/3rd-party-middleware.js" target="_blank">3rd-party-middleware.js</a></div>
            <div class="path">3rd-party-middleware.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">var express = require('express');
var cookieParser = require('cookie-parser');
var bodyParser = require('body-parser');

var app = express();

// load 3rd party middlewares
app.use(cookieParser());
app.use(bodyParser.json());

app.get('/cookie', function (req, res) {
  res.send('Cookies ' + JSON.stringify(req.cookies));
});

app.post('/json', function (req, res) {
  res.send('Post data: ' + JSON.stringify(req.body));
});

var server = app.listen(3000, function () {
  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s', host, port);
});

</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/application-level-middleware.js" target="_blank">application-level-middleware.js</a></div>
            <div class="path">application-level-middleware.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">var express = require('express');

var app = express();

// a middleware
app.use(function(req, res, next) {
  console.log(&quot;req: &quot; + req.path);
  next();
});

// a middleware bind to a path
app.get('/', function(req, res, next) {
  console.log(&quot;Hello&quot;);
  next();
}, function(req, res) {
  res.send(&quot;World!&quot;);
});

// a middleware bind to a path
app.get('/next-route', function(req, res, next) {
  res.send(&quot;World!&quot;);
  next('route'); // will skip next handler
}, function(req, res) {
  console.log(&quot;Should not get here !!&quot;);
});

var server = app.listen(3000, function () {
  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s', host, port);
});</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/built-in-middleware.js" target="_blank">built-in-middleware.js</a></div>
            <div class="path">built-in-middleware.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">var express = require('express');

var app = express();

// express.static is the only one built-in
// middleware after 4.x
app.use(express.static('public', {
  dotfiles: 'ignore',
  etag: false,
  extensions: ['html'],
  index: false,
  maxAge: '1d',
  redirect: false,
  setHeaders: function (res, path, stat) {
    res.set('x-timestamp', Date.now());
  }
}));

var server = app.listen(3000, function () {
  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s', host, port);
});</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/error-level-middleware.js" target="_blank">error-level-middleware.js</a></div>
            <div class="path">error-level-middleware.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">var express = require('express');

var app = express();

// a middleware
app.use(function(err, req, res, next) {
  console.log(&quot;we have an error: &quot; + err);
});

// a middleware bind to a path
app.get('/', function(req, res, next) {
  next('my-error');
});

var server = app.listen(3000, function () {
  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s', host, port);
});</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/index.js" target="_blank">index.js</a></div>
            <div class="path">index.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">var express = require('express');

var app = express();

function myLogger(req, res, next) {
  console.log('LOGGED: ' + req.path);
  next();
};

app.use(myLogger);

app.get('/:name', function (req, res) {
  res.send('Hello: ' + req.params.name);
});

var server = app.listen(3000, function () {
  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s', host, port);
});</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/public/index.html" target="_blank">index.html</a></div>
            <div class="path">public/index.html</div>
          </div>
          <div class="body">
            <pre class="content"><code class="html">Hello!
</code></pre>
          </div>
        </div>
        <div class="code-file panel markdown-body">
          <div class="header">
            <div class="name"><a href="https://github.com/js-demos/express-middleware-demo/blob/master/router-level-middleware.js" target="_blank">router-level-middleware.js</a></div>
            <div class="path">router-level-middleware.js</div>
          </div>
          <div class="body">
            <pre class="content"><code class="js">var express = require('express');

var router = express.Router();

// a middleware
router.use(function(req, res, next) {
  console.log(&quot;req: &quot; + req.path);
  next();
});

// a middleware bind to a path
router.get('/', function(req, res, next) {
  console.log(&quot;Hello&quot;);
  next();
}, function(req, res) {
  res.send(&quot;World!&quot;);
});

// a middleware bind to a path
router.get('/next-route', function(req, res, next) {
  res.send(&quot;World!&quot;);
  next('route'); // will skip next handler
}, function(req, res) {
  console.log(&quot;Should not get here !!&quot;);
});

var app = express();
app.use('/sub', router);

var server = app.listen(3000, function () {
  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s', host, port);
});</code></pre>
          </div>
        </div>
        <div class="github markdown-body"><span class="github-icon"><img src="/images/github.jpg"></span><span class="repo-url"><a href="https://github.com/js-demos/express-middleware-demo">打开Github项目地址</a></span><span class="repo-issues"><a href="https://github.com/js-demos/express-middleware-demo/issues?q=">有问题上Github Issues上讨论</a></span></div>
      </div>
    </div>
    <script src="/js/site.js"></script>
  </body>
</html>
